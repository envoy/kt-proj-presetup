#!/bin/bash
# bin/compile <build-dir> <cache-dir> <env-dir>

set -e

workingDir=$(pwd)
mkdir -p "$2"
buildDir=$(cd "$1/" && pwd)
cacheDir=$(cd "$2/" && pwd)
envDir=$(cd "$3/" && pwd)

main() {
    cd $buildDir
    makeNewDirectories
    installPip
    installBoto3
    downloadCertificateFromS3
    downloadJavaAgent
    uninstallBoto3
}

makeNewDirectories() {
    mkdir -p agent
    mkdir -p cert
}

installPip() {
    curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
    python get-pip.py
}

installBoto3() {
    /app/.local/bin/pip install boto3
}

uninstallBoto3() {
    /app/.local/bin/pip uninstall -y boto3
}

downloadCertificateFromS3() {
    python downloadS3.py
}

downloadJavaAgent() {
    wget -O agent/dd-java-agent.jar https://dtdg.co/latest-java-tracer
}

main
